<style>
  :root {
    --brand-black: #0b0f14;
    --brand-orange: #ff8a00;
    --brand-sky: #2fb7ff;

    --glass-border: rgba(255, 255, 255, 0.18);
    --radius-lg: 22px;
    --radius-md: 16px;
  }

  /* üî• SFONDO FULL SCREEN */
  html,
  body {
    margin: 0;
    padding: 0;
    height: 100%;
    background:
      radial-gradient(
        1000px 600px at 10% 10%,
        rgba(47, 183, 255, 0.2),
        transparent 60%
      ),
      radial-gradient(
        1000px 600px at 90% 15%,
        rgba(255, 138, 0, 0.2),
        transparent 65%
      ),
      linear-gradient(180deg, #0b0f14, #121c28);
    background-attachment: fixed;
  }

  body::before {
    content: "";
    position: fixed;
    inset: 0;
    z-index: -1;
  }

  .turni-page {
    min-height: 100vh;
    width: 100%;
    padding: 20px;
    color: rgba(255, 255, 255, 0.92);
  }

  /* ---------------- BUTTON BASE ---------------- */
  .turni-page .btn {
    color: #000 !important;
    font-weight: 900;
    border-radius: 999px !important;
    border: 1px solid rgba(255, 255, 255, 0.25);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
    transition:
      transform 0.14s ease,
      box-shadow 0.14s ease,
      background 0.16s ease;
  }

  .turni-page .btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 14px 35px rgba(0, 0, 0, 0.45);
  }

  .btn-back-glass {
    background: linear-gradient(
      135deg,
      rgba(47, 183, 255, 0.3),
      rgba(255, 138, 0, 0.3)
    );
  }

  .btn-nav-glass {
    background: rgba(255, 255, 255, 0.18);
  }

  .btn-create-glass {
    background: linear-gradient(135deg, var(--brand-orange), var(--brand-sky));
  }

  .btn-save-glass {
    background: linear-gradient(
      135deg,
      rgba(255, 138, 0, 0.45),
      rgba(47, 183, 255, 0.35)
    );
  }

  /* ---------------- GLASS PANELS ---------------- */
  .glass-panel {
    border-radius: var(--radius-lg);
    border: 1px solid var(--glass-border);
    background: rgba(255, 255, 255, 0.08);
    backdrop-filter: blur(18px);
    -webkit-backdrop-filter: blur(18px);
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.45);
  }

  /* Header dipendente (glass) */
  .emp-header {
    padding: 14px;
    border-radius: var(--radius-lg);
    border: 1px solid rgba(255, 255, 255, 0.14);
    background: rgba(255, 255, 255, 0.06);
    backdrop-filter: blur(14px);
    -webkit-backdrop-filter: blur(14px);
    box-shadow: 0 12px 30px rgba(0, 0, 0, 0.22);
  }

  /* Checkbox */
  .turni-page .form-check-input {
    width: 18px;
    height: 18px;
    border-radius: 6px;
    border: 1px solid rgba(255, 255, 255, 0.26);
    background: rgba(255, 255, 255, 0.1);
    box-shadow: 0 10px 22px rgba(0, 0, 0, 0.18);
  }
  .turni-page .form-check-input:checked {
    background-color: rgba(47, 183, 255, 0.65);
    border-color: rgba(47, 183, 255, 0.85);
  }

  /* ‚úÖ CONTROLS: hai bg-light (chiaro) -> testo NERO */
  .turni-controls {
    border-radius: var(--radius-lg) !important;
    border: 1px solid rgba(255, 255, 255, 0.18) !important;
    background: rgba(255, 255, 255, 0.92) !important; /* chiaro */
    color: #000 !important;
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.35);
  }

  /* ‚úÖ ALERT INFO: chiaro + testo nero */
  .turni-page .alert.alert-info {
    background: rgba(255, 255, 255, 0.92) !important;
    border: 1px solid rgba(0, 0, 0, 0.1) !important;
    color: #000 !important;
    border-radius: var(--radius-lg);
    box-shadow: 0 14px 36px rgba(0, 0, 0, 0.22);
  }

  /* LIST WRAPPER */
  .turni-list .list-group {
    background: transparent !important;
  }

  .turni-list .list-group-flush {
    border-radius: var(--radius-lg);
    overflow: hidden;
    border: 1px solid rgba(255, 255, 255, 0.14);
    background: rgba(255, 255, 255, 0.05);
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
    box-shadow: 0 12px 30px rgba(0, 0, 0, 0.22);
  }

  /* Riga turno (default scura) */
  .turni-item {
    border: 0 !important;
    background: rgba(255, 255, 255, 0.06) !important;
    color: rgba(255, 255, 255, 0.92) !important;
    padding: 14px;
  }
  .turni-item + .turni-item {
    border-top: 1px solid rgba(255, 255, 255, 0.1) !important;
  }

  /* ‚úÖ Se Angular applica bg-light al turno pubblicato -> testo NERO */
  .turni-item.bg-light {
    background: rgba(255, 255, 255, 0.92) !important;
    color: #000 !important;
  }

  /* Published highlight (senza rompere testo) */
  .turni-item.published {
    background: linear-gradient(
      135deg,
      rgba(46, 204, 113, 0.22),
      rgba(255, 255, 255, 0.06)
    ) !important;
    box-shadow: inset 0 0 0 1px rgba(46, 204, 113, 0.28);
  }

  /* muted su dark (default) */
  .turni-page .text-muted {
    color: rgba(255, 255, 255, 0.7) !important;
  }

  /* Key icon */
  .key-icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    border-radius: 14px;
    border: 1px solid rgba(255, 255, 255, 0.18);
    background: linear-gradient(
      135deg,
      rgba(255, 138, 0, 0.22),
      rgba(47, 183, 255, 0.16)
    );
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    box-shadow: 0 10px 22px rgba(0, 0, 0, 0.22);
    cursor: pointer;
    user-select: none;
  }

  /* Tooltip */
  .tooltip-popup {
    position: fixed;
    z-index: 2000;
    padding: 12px 16px;
    border-radius: 16px;
    background: rgba(0, 0, 0, 0.85);
    color: white;
    backdrop-filter: blur(14px);
    -webkit-backdrop-filter: blur(14px);
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6);
    pointer-events: none;
  }

  /* =========================================================
     ‚úÖ‚úÖ FORZA TESTI NERI SU QUALSIASI SFONDO CHIARO
     (anche roba generata automaticamente dentro quei blocchi)
     ---------------------------------------------------------
     Se dentro un blocco chiaro ci finisce qualsiasi tag,
     deve diventare NERO.
  ========================================================= */

  /* Blocchi chiari certi */
  .turni-controls,
  .turni-page .alert.alert-info,
  .turni-item.bg-light {
    color: #000 !important;
  }

  /* TUTTO il contenuto dentro blocchi chiari -> nero */
  .turni-controls *,
  .turni-page .alert.alert-info *,
  .turni-item.bg-light * {
    color: #000 !important;
  }

  /* Forza anche muted dentro blocchi chiari */
  .turni-controls .text-muted,
  .turni-page .alert.alert-info .text-muted,
  .turni-item.bg-light .text-muted,
  .turni-item.bg-light small,
  .turni-item.bg-light .small {
    color: rgba(0, 0, 0, 0.6) !important;
  }

  /* Bootstrap utility che pu√≤ sbiancare */
  .turni-controls .text-white,
  .turni-page .alert.alert-info .text-white,
  .turni-item.bg-light .text-white {
    color: #000 !important;
  }

  /* Form / label nel box chiaro */
  .turni-controls label,
  .turni-controls input,
  .turni-controls span,
  .turni-controls small,
  .turni-controls strong {
    color: #000 !important;
  }

  /* Icone dentro box chiari */
  .turni-controls i,
  .turni-item.bg-light i {
    color: #000 !important;
  }

  /* WhatsApp icon lasciata com'√® */
  .btn-wa .text-success {
    color: #25d366 !important;
  }
</style>

<div class="container py-4 turni-page">
  <!-- üîô Torna indietro -->
  <div class="d-flex justify-content-start align-items-center mb-3">
    <button
      class="btn btn-outline-primary rounded-pill btn-back-glass"
      (click)="back()"
    >
      ‚¨Ö Torna Indietro
    </button>
  </div>

  <h2 class="text-center mb-4 turni-title text-dark">Gestione Turni</h2>

  <!-- üîπ Navigazione per data + Crea turno -->
  <div
    class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2 turni-date-row"
  >
    <div class="d-flex align-items-center gap-2">
      <button
        class="btn btn-secondary rounded-pill btn-nav-glass"
        (click)="prevDay()"
      >
        ‚Üê
      </button>
      <h4 class="m-0 text-dark">{{ selectedDate | date: "fullDate" }}</h4>
      <button
        class="btn btn-secondary rounded-pill btn-nav-glass"
        (click)="nextDay()"
      >
        ‚Üí
      </button>
    </div>

    <button
      class="btn btn-primary rounded-pill px-4 btn-create-glass"
      (click)="createShifts()"
      title="Crea nuovi turni per questa data"
    >
      ‚ûï Crea Turni
    </button>
  </div>

  <!-- üîπ Seleziona tutto + Salva -->
  <div class="border rounded p-3 mb-4 bg-light shadow-sm turni-controls">
    <div
      class="d-flex justify-content-between align-items-center flex-wrap gap-2"
    >
      <div class="d-flex align-items-center">
        <input
          type="checkbox"
          id="selectAll"
          class="form-check-input"
          [(ngModel)]="selectAll"
          (change)="toggleSelectAll()"
          [disabled]="isSaving"
        />
        <label for="selectAll" class="ms-2 fw-bold">Seleziona tutto</label>
      </div>

      <button
        class="btn btn-primary rounded-pill btn-save-glass"
        (click)="savePublication()"
        [disabled]="isSaving"
      >
        <span *ngIf="!isSaving">üíæ Salva modifiche</span>
        <span *ngIf="isSaving">‚è≥ Salvataggio...</span>
      </button>
    </div>
  </div>

  <!-- üîπ Lista turni -->
  <div *ngIf="shifts.length === 0" class="alert alert-info text-center">
    Nessun turno presente per il giorno selezionato.
  </div>

  <div class="turni-list" *ngIf="shifts.length > 0">
    <ul class="list-group">
      <div *ngFor="let empName of groupedKeys()">
        <!-- Dipendente -->
        <div class="d-flex align-items-center mt-3 emp-header">
          <input
            type="checkbox"
            class="form-check-input me-2"
            [(ngModel)]="publishedState[getEmpId(empName)]"
            (change)="updateSelectAllState()"
            [disabled]="isSaving"
          />

          <h4 class="mb-0 text-dark">
            {{ empName.toUpperCase() }}
            <small class="text-dark">
              ‚Äî
              {{
                selectedDate | date: "EEEE d MMMM y" : "" : "it-IT" | uppercase
              }}
            </small>
          </h4>

          <button
            class="btn btn-link p-0 ms-2 btn-wa"
            (click)="sendViaWhatsApp(empName)"
            title="Invia via WhatsApp"
          >
            <i class="fab fa-whatsapp fa-lg text-success"></i>
          </button>
        </div>

        <!-- Turni del dipendente -->
        <ul class="list-group list-group-flush mt-2">
          <li
            class="list-group-item d-flex justify-content-between align-items-center turni-item"
            *ngFor="let turno of groupedByEmployee[empName]"
            [ngClass]="{
              published: publishedState[turno.empId],
              'bg-light border-success': publishedState[turno.empId],
            }"
          >
            <span class="text-dark">
              <strong>{{ turno.title }}</strong>
              <span *ngIf="turno.start">
                ‚Äî {{ turno.start | date: "HH:mm" }}
              </span>
              <span class="ms-2 small text-dark">
                ‚Ä¢ Durata: {{ formatDuration(turno.duration) }}
              </span>
              <br />
              <small class="text-dark">
                {{ turno.description }}
                <span *ngIf="turno.colleghi?.length">
                  üë• Con: {{ turno.colleghi?.join(", ") }}
                </span>
                <span *ngIf="!turno.colleghi?.length">üë§ Da solo</span>
              </small>
            </span>

            <span
              *ngIf="turno.keyRequired"
              class="key-icon ms-2"
              (click)="handleClick($event, turno.appointmentId)"
              title="Chiavi richieste"
            >
              üîë
            </span>
          </li>
        </ul>
      </div>
    </ul>
  </div>
</div>

<!-- Tooltip -->
<div
  class="tooltip-popup"
  *ngIf="tooltipVisible"
  [style.top.px]="tooltipPosition.top"
  [style.left.px]="tooltipPosition.left"
>
  {{ tooltipText }}
</div>
