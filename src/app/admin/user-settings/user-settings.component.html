<div class="container py-4">
  <div class="d-flex justify-content-start align-items-center mb-3">
    <button class="btn btn-outline-primary rounded-pill" (click)="back()">
      â¬… Torna Indietro
    </button>
  </div>

  <h2 class="text-center mb-4">Gestione Amministratori</h2>

  <div class="admin-list mb-5">
    <mat-card *ngFor="let admin of admins; let i = index" class="admin-card">
      <mat-card-content>
        <!-- VIEW MODE -->
        <div class="admin-details mb-3" *ngIf="editingIndex !== i">
          <p><strong>Nome:</strong> {{ admin.nome }}</p>
          <p><strong>Cognome:</strong> {{ admin.cognome }}</p>
          <p><strong>Email:</strong> {{ admin.email }}</p>
          <p><strong>Codice Operatore:</strong> {{ admin.codiceOperatore }}</p>
          <p><strong>Permessi:</strong> {{ (admin.permissions || []).join(', ') }}</p>
        </div>

        <!-- EDIT MODE -->
        <div *ngIf="editingIndex === i" class="mb-3">
          <div class="mb-2">
  <p class="mb-1"><strong>Permessi</strong></p>
  <div class="permissions-grid">
    <label class="perm-item" *ngFor="let p of permissionOptions">
      <input type="checkbox"
        [checked]="(adminEdit.permissions || []).includes(p.key)"
        (change)="togglePermission(adminEdit, p.key)" />
      <span>{{ p.label }}</span>
    </label>
  </div>
</div>
        </div>

        <div class="d-flex gap-2">
          <button
            mat-raised-button
            color="primary"
            *ngIf="editingIndex !== i"
            (click)="startEditAdmin(i)"
          >
            Modifica
          </button>

          <button
            mat-raised-button
            color="accent"
            *ngIf="editingIndex === i"
            (click)="saveEditAdmin()"
          >
            Salva
          </button>

          <button
            mat-raised-button
            *ngIf="editingIndex === i"
            (click)="cancelEditAdmin()"
          >
            Annulla
          </button>

          <button mat-raised-button color="warn" (click)="deleteAdmin(i)">
            Elimina
          </button>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <div class="admin-form">
    <mat-card>
      <mat-card-title>Aggiungi Nuovo Admin</mat-card-title>
      <mat-card-content>
        <form class="add-admin-form">
          <div class="mb-2">
  <p class="mb-1"><strong>Permessi</strong></p>
  <div class="permissions-grid">
    <label class="perm-item" *ngFor="let p of permissionOptions">
      <input type="checkbox"
        [checked]="(adminAdd.permissions || []).includes(p.key)"
        (change)="togglePermission(adminAdd, p.key)" />
      <span>{{ p.label }}</span>
    </label>
  </div>
</div>

          <button mat-raised-button color="primary" (click)="addAdmin()">
            Aggiungi
          </button>
        </form>
      </mat-card-content>
    </mat-card>
  </div>
</div>
