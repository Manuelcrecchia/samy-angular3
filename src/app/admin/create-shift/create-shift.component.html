<div class="container-fluid py-4">
  <div class="d-flex justify-content-start align-items-center mb-3">
    <button class="btn-back" type="button" (click)="goBack()">
      &larr; Torna Indietro
    </button>
  </div>

  <h2 class="text-dark">Assegnazione Turni</h2>

  <div class="row" style="height: calc(100vh - 150px)">
    <!-- COLONNA SINISTRA -->
    <div class="col-md-8 border-end" style="height: 100%; overflow-y: auto">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <button (click)="prevDay()" class="btn btn-secondary">&larr;</button>
        <h4 class="m-0 text-dark">{{ selectedDate | date : "fullDate" }}</h4>
        <button (click)="nextDay()" class="btn btn-secondary">&rarr;</button>
      </div>

      <div *ngIf="loading" class="text-center">Caricamento...</div>
      <div
        *ngIf="!loading && appointments.length === 0"
        class="alert alert-info"
      >
        Nessun lavoro per questo giorno.
      </div>

      <div *ngIf="!loading && appointments.length > 0" class="list-group">
        <div class="text-center mb-3">
          <button class="btn btn-outline-primary btn-sm" (click)="addExtra()">
            ‚ûï Aggiungi lavoro extra
          </button>
        </div>

        <div
          *ngFor="let a of appointments"
          class="list-group-item d-flex align-items-center justify-content-between"
        >
          <div class="flex-grow-1 me-3">
            <div>
              <strong *ngIf="!a.isExtra">{{ a.title }}</strong>
              <input
                *ngIf="a.isExtra"
                type="text"
                class="form-control form-control-sm mb-1"
                [(ngModel)]="a.title"
                (ngModelChange)="onTitleChange(a, $event)"
                placeholder="Titolo lavoro extra"
              />
            </div>
            <div>
              <textarea
                class="form-control form-control-sm"
                [(ngModel)]="a.description"
                (ngModelChange)="onDescriptionChange(a, $event)"
                placeholder="Descrizione"
              ></textarea>
            </div>
          </div>

          <button
            class="btn btn-sm btn-outline-primary me-2"
            (click)="openAssignmentDialog(a)"
          >
            üë•
          </button>

          <div class="me-2" style="min-width: 90px">
            <input
              type="text"
              class="form-control form-control-sm"
              placeholder="HH:mm"
              [ngModel]="getShiftTime(a)"
              (ngModelChange)="onTimeTextChange(a, $event)"
            />
          </div>

          <div class="me-2" style="min-width: 100px">
            <select
              class="form-control form-control-sm"
              [(ngModel)]="a.duration"
              (ngModelChange)="onDurationChange(a, $event)"
            >
              <option *ngFor="let d of durationOptions" [ngValue]="d">
                {{ formatDuration(d) }}
              </option>
            </select>
          </div>

          <div *ngIf="!isComplete(a)" class="text-danger me-2">‚ùó</div>

          <button
            *ngIf="a.isExtra"
            class="btn btn-sm btn-outline-danger"
            (click)="removeExtra(a)"
          >
            ‚ùå
          </button>
        </div>

        <div class="text-center mt-3">
          <button class="btn btn-outline-primary btn-sm" (click)="addExtra()">
            ‚ûï Aggiungi lavoro extra
          </button>
        </div>
      </div>

      <div class="text-center mt-4">
        <button class="btn btn-success" (click)="finalSave()">
          üíæ Salva Turni
        </button>
      </div>
    </div>

    <!-- COLONNA DESTRA -->
    <div class="col-md-4" style="height: 100%; overflow-y: auto">
      <h5 class="text-center">Lavori selezionati per dipendente</h5>
      <div *ngFor="let emp of employeeList" class="card my-2 shadow-sm">
        <div class="card-header bg-light fw-bold">
          {{ emp.nome }} {{ emp.cognome }}
          <span class="float-end text-muted"
            >Totale: {{ getEmployeeTotalDuration(emp.id) }}</span
          >
        </div>
        <div
          cdkDropList
          [cdkDropListData]="getEmployeeShifts(emp.id)"
          (cdkDropListDropped)="dropForEmployee($event, emp.id)"
          class="card-body p-2"
        >
          <div
            *ngFor="let job of getEmployeeShifts(emp.id)"
            class="border rounded p-2 my-1 bg-white"
            cdkDrag
          >
            {{ job.title }}
            <small class="text-muted">
              <span *ngIf="getShiftTime(job)">({{ getShiftTime(job) }})</span> ‚Ä¢
              {{ formatDuration(job.duration) }}
            </small>
          </div>
        </div>
      </div>

      <h5 class="text-center mt-4">Turni della settimana precedente</h5>
      <div class="list-group mt-3">
        <div class="list-group-item" *ngFor="let item of previousWeekShiftList">
          <strong>{{ item.cliente }}:</strong><br />
          <span>{{ item.dipendenti.join(", ") || "Nessuno" }}</span>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  :root{
    --brand-black:#0b0f14;
    --brand-orange:#ff8a00;
    --brand-sky:#2fb7ff;

    --glass-border: rgba(255,255,255,0.18);
    --shadow-soft: 0 18px 60px rgba(0,0,0,0.30);
    --shadow-card: 0 10px 30px rgba(0,0,0,0.18);

    --radius-lg: 22px;
    --radius-md: 16px;
  }

  /* Background full screen */
  html, body{
    height:100%;
    margin:0;
    background:
      radial-gradient(1100px 680px at 10% 10%, rgba(47,183,255,0.20), transparent 60%),
      radial-gradient(1100px 680px at 90% 15%, rgba(255,138,0,0.20), transparent 65%),
      linear-gradient(180deg, #0b0f14, #121c28);
    background-attachment: fixed;
  }

  /* Page */
  .container-fluid.py-4{
    min-height: 100vh;
    color: rgba(255,255,255,0.92);
  }

  /* Titoli */
  .container-fluid.py-4 h2{
    font-weight: 950;
    letter-spacing: .2px;
  }
  .container-fluid.py-4 h4,
  .container-fluid.py-4 h5{
    font-weight: 900;
  }

  /* Back button */
  .btn-back{
    display:inline-flex;
    align-items:center;
    gap:10px;
    padding:10px 14px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,0.22);
    background: linear-gradient(135deg, rgba(47,183,255,0.30), rgba(255,138,0,0.28));
    color:#000 !important;
    font-weight: 950;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    box-shadow: 0 10px 26px rgba(0,0,0,0.22);
    transition: transform 140ms ease, box-shadow 140ms ease;
  }
  .btn-back:hover{
    transform: translateY(-1px);
    box-shadow: 0 14px 36px rgba(0,0,0,0.30);
  }

  /* Buttons: testo sempre nero */
  .container-fluid.py-4 .btn{
    color:#000 !important;
    font-weight: 900;
    border-radius: 999px !important;
    border: 1px solid rgba(255,255,255,0.22) !important;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    box-shadow: 0 10px 24px rgba(0,0,0,0.22);
    transition: transform 140ms ease, box-shadow 140ms ease, background 160ms ease;
  }
  .container-fluid.py-4 .btn:hover{
    transform: translateY(-1px);
    box-shadow: 0 14px 36px rgba(0,0,0,0.30);
  }

  /* Specific buttons */
  .container-fluid.py-4 .btn.btn-secondary{
    background: rgba(255,255,255,0.16) !important;
  }
  .container-fluid.py-4 .btn.btn-outline-primary{
    background: linear-gradient(135deg, rgba(255,138,0,0.18), rgba(47,183,255,0.14)) !important;
  }
  .container-fluid.py-4 .btn.btn-success{
    background: linear-gradient(135deg, rgba(46,204,113,0.55), rgba(47,183,255,0.18)) !important;
  }
  .container-fluid.py-4 .btn.btn-outline-danger{
    background: linear-gradient(135deg, rgba(255,77,77,0.60), rgba(255,138,0,0.10)) !important;
  }

  /* Layout: colonne come pannelli glass */
  .row[style*="height: calc(100vh - 150px)"]{
    border-radius: var(--radius-lg);
    overflow: hidden;
    border: 1px solid rgba(255,255,255,0.14);
    background: rgba(255,255,255,0.06);
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
    box-shadow: var(--shadow-soft);
  }

  .col-md-8.border-end{
    border-right: 1px solid rgba(255,255,255,0.14) !important;
  }

  /* Alerts: chiari + testo nero (leggibili) */
  .alert{
    border-radius: var(--radius-lg);
    border: 1px solid rgba(0,0,0,0.10) !important;
    background: rgba(255,255,255,0.92) !important;
    color:#000 !important;
    box-shadow: var(--shadow-card);
  }

  /* List group reset */
  .list-group{
    border: none !important;
    padding: 0 !important;
    background: transparent !important;
  }

  /* Appointments item -> card chiara */
  .list-group-item{
    display:flex;
    align-items:flex-start;
    justify-content:space-between;
    gap: 10px;

    border: 1px solid rgba(0,0,0,0.10) !important;
    border-radius: var(--radius-md) !important;
    margin-bottom: 10px;
    padding: 12px;

    background: rgba(255,255,255,0.92) !important;
    color:#000 !important;
    box-shadow: 0 10px 24px rgba(0,0,0,0.14);
    transition: transform 140ms ease, box-shadow 140ms ease;
  }
  .list-group-item:hover{
    transform: translateY(-1px);
    box-shadow: 0 14px 34px rgba(0,0,0,0.20);
  }

  /* Inputs/selects/textarea in items: chiari + testo nero */
  .list-group-item input[type="text"],
  .list-group-item textarea,
  .list-group-item select,
  .list-group-item .form-control,
  .list-group-item .form-select{
    border-radius: 14px !important;
    border: 1px solid rgba(0,0,0,0.12) !important;
    background: rgba(255,255,255,0.95) !important;
    color:#000 !important;
    font-size: 13px;
    box-shadow: 0 10px 22px rgba(0,0,0,0.10);
  }
  .list-group-item textarea{
    resize: vertical;
    min-height: 48px;
  }
  .list-group-item input::placeholder,
  .list-group-item textarea::placeholder{
    color: rgba(0,0,0,0.55) !important;
  }

  /* Orario: pi√π largo e centrato */
  .list-group-item input[type="time"],
  .list-group-item input[placeholder="HH:mm"]{
    width: 110px;
    min-width: 110px;
    text-align: center;
    font-size: 14px;
  }

  /* Colonna destra: card dipendente glass */
  .card{
    border-radius: var(--radius-lg) !important;
    border: 1px solid rgba(255,255,255,0.14) !important;
    background: rgba(255,255,255,0.06) !important;
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
    box-shadow: var(--shadow-card) !important;
    overflow: hidden;
  }
  .card-header.bg-light{
    background: rgba(255,255,255,0.92) !important;
    border-bottom: 1px solid rgba(0,0,0,0.10) !important;
  }
  .card-body{
    background: rgba(255,255,255,0.04) !important;
  }

  /* Drag items (bg-white) -> testo nero sicuro */
  .bg-white{
    background: rgba(255,255,255,0.92) !important;
  }

  /* Previous week list items */
  .col-md-4 .list-group-item{
    background: rgba(255,255,255,0.92) !important;
    color:#000 !important;
  }

  /* =========================================================
     ‚úÖ‚úÖ FORZA TESTI NERI SU QUALSIASI BLOCCO CHIARO
     (anche roba generata automaticamente)
  ========================================================= */

  /* Contenitori chiari principali */
  .alert,
  .list-group-item,
  .card-header.bg-light,
  .bg-white{
    color:#000 !important;
  }

  /* TUTTO dentro quei contenitori -> nero */
  .alert *,
  .list-group-item *,
  .card-header.bg-light *,
  .bg-white *{
    color:#000 !important;
  }

  /* ‚Äúmuted‚Äù dentro chiaro -> grigio scuro leggibile */
  .alert .text-muted,
  .list-group-item .text-muted,
  .card-header.bg-light .text-muted,
  .bg-white .text-muted,
  .list-group-item small,
  .list-group-item .small{
    color: rgba(0,0,0,0.60) !important;
  }

  /* Bootstrap che pu√≤ sbiancare */
  .alert .text-white,
  .list-group-item .text-white,
  .card-header.bg-light .text-white,
  .bg-white .text-white{
    color:#000 !important;
  }

  /* Error marker: resta rosso visibile */
  .text-danger{
    color: #b02a37 !important;
    font-weight: 950;
  }

  /* Mobile */
  @media (max-width: 767.98px){
    .row[style*="height: calc(100vh - 150px)"]{
      height: auto !important;
    }
    .col-md-8.border-end{
      border-right: 0 !important;
      border-bottom: 1px solid rgba(255,255,255,0.14) !important;
    }
  }
</style>