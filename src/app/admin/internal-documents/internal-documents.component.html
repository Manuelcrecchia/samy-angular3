<mat-toolbar color="primary" class="docs-toolbar">
  <span class="toolbar-title text-dark">Gestione Documenti</span>
  <span class="spacer"></span>

  <button class="btn-back-glass" type="button" (click)="back()">
    &larr; Torna Indietro
  </button>
</mat-toolbar>

<div class="docs-page container-fluid">
  <div class="docs-shell">
    <!-- Sidebar -->
    <aside class="sidebar glass-panel">
      <div class="sidebar-head">
        <h3 class="sidebar-title">Cartelle</h3>
      </div>

      <mat-list class="folder-list">
        <mat-list-item *ngFor="let folder of folders" class="folder-item">
          <button
            mat-button
            (click)="selectFolder(folder)"
            class="folder-btn"
            [class.selected]="folder === selectedFolder"
          >
            {{ folder }}
          </button>

          <button
            mat-icon-button
            color="warn"
            (click)="deleteFolder(folder)"
            matTooltip="Elimina"
            class="icon-btn icon-danger"
          >
            <mat-icon>delete</mat-icon>
          </button>
        </mat-list-item>
      </mat-list>

      <div class="new-folder glass-subpanel">
        <mat-form-field appearance="fill" class="w-100">
          <mat-label>Nuova cartella</mat-label>
          <input matInput [(ngModel)]="newFolderName" />
        </mat-form-field>

        <button
          mat-raised-button
          color="accent"
          (click)="createFolder()"
          class="btn-brand"
        >
          Crea
        </button>
      </div>
    </aside>

    <!-- Main -->
    <main class="main glass-panel">
      <div class="main-head">
        <h3 class="main-title" *ngIf="selectedFolder">
          File in "{{ selectedFolder }}"
        </h3>

        <div class="file-upload" *ngIf="selectedFolder">
          <input type="file" #fileInput (change)="uploadFile($event)" hidden />
          <button
            mat-raised-button
            color="primary"
            (click)="fileInput.click()"
            class="btn-brand"
          >
            Carica File
          </button>
        </div>
      </div>

      <div class="empty-hint" *ngIf="!selectedFolder">
        Seleziona una cartella a sinistra per vedere e gestire i documenti.
      </div>

      <mat-list *ngIf="selectedFolder" class="file-list">
        <mat-list *ngIf="selectedFolder" class="file-list">
  <mat-list-item *ngFor="let file of files" class="file-item">
    <div *ngIf="selectedFolder" class="file-list">
  <div class="file-row" *ngFor="let file of files">
    <!-- click su riga = seleziona file -->
    <button
      type="button"
      class="file-main"
      (click)="selectFile(file.filename)"
    >
      <span class="file-name">{{ file.filename }}</span>

      <span class="doc-status" *ngIf="file.viewed">
        ‚úÖ Visualizzato {{ file.viewedAt | date: "dd/MM/yyyy HH:mm" }}
      </span>

      <span class="doc-status pending" *ngIf="!file.viewed">
        ‚è≥ Non visualizzato
      </span>
    </button>

    <!-- azioni SEMPRE a destra -->
    <div class="file-actions">
      <button
        mat-icon-button
        class="icon-btn icon-primary"
        title="Scarica"
        type="button"
        (click)="downloadCurrentFile(file.filename); $event.stopPropagation()"
      >
        <mat-icon>download</mat-icon>
      </button>

      <button
        mat-icon-button
        class="icon-btn icon-danger"
        title="Elimina"
        type="button"
        (click)="deleteFile(file.filename); $event.stopPropagation()"
      >
        <mat-icon>delete</mat-icon>
      </button>
    </div>
  </div>
</div>
  </mat-list-item>
</mat-list>
      </mat-list>

      <div *ngIf="pdfBase64" class="pdf-viewer">
        <ngx-extended-pdf-viewer
          [base64Src]="pdfBase64"
          useBrowserLocale="true"
          height="90vh"
          [customToolbar]="customToolbar"
        ></ngx-extended-pdf-viewer>

        <ng-template #customToolbar>
          <div class="pdf-toolbar">
            <button
              mat-raised-button
              color="accent"
              class="btn-brand"
              (click)="printFile(currentFilename)"
            >
              üñ®Ô∏è Stampa
            </button>

            <button
              mat-raised-button
              color="accent"
              class="btn-brand"
              (click)="downloadCurrentFile(currentFilename)"
            >
              ‚¨áÔ∏è Scarica
            </button>
          </div>
        </ng-template>
      </div>
    </main>
  </div>
</div>